# Принципы разработки и план создания конвертера

Этот документ определяет ключевые принципы и последовательность шагов для создания скрипта-конвертера данных из формата `reverse/cloud.ru/advanced/` в формат `seaf-core/entities/ta/`.

## 1. Принципы разработки

1.  **Итеративный подход:** Мы будем работать последовательно, фокусируясь на одной сущности за раз. Это позволит упростить отладку, тестирование и решение проблем с маппингом.
2.  **Разработка через тестирование (TDD-like):** Для каждой конвертируемой сущности сначала будут создаваться тестовые сценарии, которые проверяют корректность преобразования данных. Это гарантирует качество и предсказуемость результата.
3.  **Модульность:** Логика конвертации для каждой сущности будет вынесена в отдельный, независимый модуль (функцию). Это обеспечит гибкость и упростит поддержку кода.
4.  **Конфигурируемость:** Скрипт должен быть гибким в настройке. Управление его работой (пути к данным, выбор сущностей) будет осуществляться как через конфигурационный файл, так и через аргументы командной строки, где аргументы имеют приоритет.
5.  **Опора на документацию:** В качестве основного источника правил для преобразования данных используется документ `mapping_analysis.md`. Все сложные или неочевидные решения по маппингу, принятые в ходе разработки, будут задокументированы.
6.  **Чистый и документированный код:** Весь код будет писаться с использованием современных практик Python, включая аннотации типов, четкие имена переменных и комментарии для нетривиальных участков логики.

## 2. План создания скрипта

Разработка будет разделена на несколько ключевых этапов.

### Этап 1: Создание каркаса скрипта

На этом этапе мы создадим базовую структуру проекта и основную логику управления.

1.  **Структура проекта:**
    *   `converter.py`: Главный исполняемый файл.
    *   `converter_config.yaml`: Файл конфигурации по умолчанию.
    *   `modules/`: Директория для модулей-конвертеров (например, `vpc_converter.py`, `subnet_converter.py`).
    *   `tests/`: Директория для тестов.
    *   `utils/`: Директория для вспомогательных функций (чтение YAML, запись файлов и т.д.).

2.  **Реализация базовой логики в `converter.py`:**
    *   Настройка парсинга аргументов командной строки (`argparse`) для указания путей к исходным данным, результатам, и выбора сущностей.
    *   Реализация загрузки конфигурации из `converter_config.yaml` (с использованием библиотеки `PyYAML`).
    *   Создание основной функции, которая будет динамически вызывать нужные модули-конвертеры в зависимости от конфигурации.
    *   Реализация базовых утилит для чтения и записи YAML-файлов.

### Этап 2: Итеративная разработка конвертеров сущностей

Мы будем последовательно реализовывать логику конвертации для каждой сущности, начиная с базовых, от которых зависят другие.

**Порядок итераций:**

1.  **VPC:** `vpc` -> `seaf.ta.services.network_segment`
2.  **Subnet:** `subnet` -> `seaf.ta.services.network`
3.  **ECS (VMs):** `ecss` -> `seaf.ta.components.server`
4.  **CCE (Kubernetes):** `cces` -> `seaf.ta.services.k8s`
5.  **RDS (Databases):** `rdss` -> `seaf.ta.services.cluster` (с типом "СУБД")
6.  **ELB (Load Balancers):** `elbs` -> `seaf.ta.components.network` (с типом "Балансировщик")
7.  **NAT Gateways:** `nat_gateways` -> `seaf.ta.components.network` (с типом "NAT")
8.  **VPN Gateways:** `vpn_gateways` -> `seaf.ta.components.network` (с типом "VPN")
9.  **VPN Connections:** `vpn_connections` -> `seaf.ta.services.network_links`
10. **Peerings:** `peerings` -> `seaf.ta.services.network_links`
11. **Vaults & Backups:** `vaults` -> `seaf.ta.services.storage` и `seaf.ta.services.backup`
12. **Прочие сущности:** `eips`, `dmss`, `security_groups` и другие, согласно анализу маппинга.

Для каждой сущности будет выполнен полный цикл: **написание теста -> реализация конвертера -> запуск теста -> рефакторинг**.
